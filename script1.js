let stats={totalSolved:0,correct:0,currentStreak:0,bestStreak:0,tableProgress:{2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},averageTime:0,totalTime:0,fastestAnswer:999,slowestAnswer:0,dailyStats:{},weeklyStreak:0,bestWeeklyStreak:0},currentMode="",currentQuestion={},gameTimer=null,timeLeft=0,questionsAnswered=0,totalQuestions=0,currentNumber=0,sessionStreak=0,sessionStats={correct:0,incorrect:0,totalTime:0,fastestAnswer:999,slowestAnswer:0},questionStartTime=0,usedQuestions=new Set;function loadStats(){const t=JSON.parse(localStorage.getItem("multiplicationStats")||"{}");stats={...stats,...t},updateDailyStats()}function saveStats(){localStorage.setItem("multiplicationStats",JSON.stringify(stats))}function updateDailyStats(){const t=(new Date).toDateString();stats.dailyStats[t]||(stats.dailyStats[t]={solved:0,correct:0});const e=Object.keys(stats.dailyStats).sort();let s=0,n=new Date;for(let t=e.length-1;t>=0;t--){const a=new Date(e[t]);if(!(Math.floor((n-a)/864e5)===s&&stats.dailyStats[e[t]].solved>0))break;s++,n=a}stats.weeklyStreak=s,stats.weeklyStreak>stats.bestWeeklyStreak&&(stats.bestWeeklyStreak=stats.weeklyStreak)}function updateMainMenuStats(){document.getElementById("totalSolved").textContent=stats.totalSolved,document.getElementById("accuracy").textContent=stats.totalSolved>0?Math.round(stats.correct/stats.totalSolved*100)+"%":"0%",document.getElementById("currentStreak").textContent=stats.currentStreak,document.getElementById("bestStreak").textContent=stats.bestStreak}function resetSessionStats(){sessionStats={correct:0,incorrect:0,totalTime:0,fastestAnswer:999,slowestAnswer:0},sessionStreak=0,usedQuestions.clear()}function generateUniqueQuestion(t){let e,s,n,a=0;do{e=Array.isArray(t)?t[Math.floor(Math.random()*t.length)]:"random"===t?Math.floor(8*Math.random())+2:t,s=Math.floor(9*Math.random())+1,n=`${e}x${s}`,a++}while(usedQuestions.has(n)&&a<100);return a>=100&&usedQuestions.clear(),usedQuestions.add(n),{num1:e,num2:s,correctAnswer:e*s}}function showMainMenu(){document.querySelectorAll(".content-area").forEach((t=>t.classList.add("hidden"))),document.getElementById("mainMenu").classList.remove("hidden"),document.getElementById("fm").classList.remove("hidden"),document.querySelector(".back-btn").classList.add("hidden"),updateMainMenuStats(),gameTimer&&(clearInterval(gameTimer),gameTimer=null)}function showLearning(){document.getElementById("mainMenu").classList.add("hidden"),document.getElementById("fm").classList.add("hidden"),document.getElementById("learningMode").classList.remove("hidden"),document.querySelector(".back-btn").classList.remove("hidden")}function showTraining(){document.getElementById("mainMenu").classList.add("hidden"),document.getElementById("trainingMode").classList.remove("hidden"),document.querySelector(".back-btn").classList.remove("hidden"),document.getElementById("trainingSetup").classList.remove("hidden"),document.getElementById("trainingGame").classList.add("hidden"),document.getElementById("fm").classList.add("hidden")}function showTesting(){document.getElementById("mainMenu").classList.add("hidden"),document.getElementById("testingMode").classList.remove("hidden"),document.querySelector(".back-btn").classList.remove("hidden"),document.getElementById("testingSetup").classList.remove("hidden"),document.getElementById("testingGame").classList.add("hidden"),document.getElementById("fm").classList.add("hidden")}function showProgress(){document.getElementById("mainMenu").classList.add("hidden"),document.getElementById("progressMode").classList.remove("hidden"),document.querySelector(".back-btn").classList.remove("hidden"),document.getElementById("fm").classList.add("hidden"),updateProgressDisplay()}function showHowTo(){document.getElementById("mainMenu").classList.add("hidden"),document.getElementById("howto").classList.remove("hidden"),document.querySelector(".back-btn").classList.remove("hidden"),document.getElementById("fm").classList.add("hidden")}function showMultiplicationTable(t){const e=document.getElementById("multiplicationTable");let s=`<h3>–¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è –Ω–∞ ${t}</h3><div class="multiplication-table">`;for(let e=1;e<=10;e++)s+=`<div class="table-cell">${t} √ó ${e} = ${t*e}</div>`;s+="</div>",e.innerHTML=s}function startTraining(t){currentNumber=t,currentMode="training",questionsAnswered=0,totalQuestions=10,timeLeft=60,resetSessionStats(),document.getElementById("trainingSetup").classList.add("hidden"),document.getElementById("trainingGame").classList.remove("hidden"),startTimer("training"),generateTrainingQuestion()}function startTesting(t){switch(currentMode="testing",questionsAnswered=0,timeLeft=90,resetSessionStats(),t){case"easy":totalQuestions=15,currentNumber=[2,3,4,5];break;case"medium":totalQuestions=20,currentNumber=[2,3,4,5,6,7];break;case"hard":totalQuestions=25,currentNumber=[2,3,4,5,6,7,8,9]}document.getElementById("testingSetup").classList.add("hidden"),document.getElementById("testingGame").classList.remove("hidden"),startTimer("testing"),generateTestingQuestion()}function startTimer(t){gameTimer&&clearInterval(gameTimer),gameTimer=setInterval((()=>{timeLeft--,document.getElementById(t+"Timer").textContent=`‚è±Ô∏è ${timeLeft}`,timeLeft<=0&&endGame(t)}),1e3)}function generateTrainingQuestion(){currentQuestion=generateUniqueQuestion(currentNumber),questionStartTime=Date.now(),document.getElementById("trainingQuestion").textContent=`${currentQuestion.num1} √ó ${currentQuestion.num2} = ?`;const t=[currentQuestion.correctAnswer];for(;t.length<4;){const e=currentQuestion.correctAnswer+Math.floor(20*Math.random())-10;e>0&&!t.includes(e)&&t.push(e)}t.sort((()=>Math.random()-.5));const e=document.getElementById("trainingOptions");e.innerHTML="",t.forEach((t=>{const s=document.createElement("button");s.className="option-btn",s.textContent=t,s.onclick=()=>checkTrainingAnswer(t),e.appendChild(s)})),updateProgress("training")}function generateTestingQuestion(){const t=Array.isArray(currentNumber)?currentNumber:[2,3,4,5,6,7,8,9];currentQuestion=generateUniqueQuestion(t),questionStartTime=Date.now(),document.getElementById("testingQuestion").textContent=`${currentQuestion.num1} √ó ${currentQuestion.num2} = ?`,document.getElementById("testingInput").value="",document.getElementById("testingInput").focus(),document.getElementById("testingFeedback").innerHTML="",updateProgress("testing")}function processAnswer(t){const e=(Date.now()-questionStartTime)/1e3;stats.totalSolved++,questionsAnswered++,sessionStats.totalTime+=e,e>sessionStats.slowestAnswer&&(sessionStats.slowestAnswer=e),e<sessionStats.fastestAnswer&&(sessionStats.fastestAnswer=e),t?(stats.correct++,sessionStats.correct++,stats.currentStreak++,sessionStreak++,stats.currentStreak>stats.bestStreak&&(stats.bestStreak=stats.currentStreak),"random"===currentNumber||Array.isArray(currentNumber)||stats.tableProgress[currentNumber]++):(sessionStats.incorrect++,stats.currentStreak=0,sessionStreak=0),stats.totalTime+=e,stats.averageTime=stats.totalTime/stats.totalSolved,e>stats.slowestAnswer&&(stats.slowestAnswer=e),e<stats.fastestAnswer&&(stats.fastestAnswer=e);const s=(new Date).toDateString();stats.dailyStats[s]||(stats.dailyStats[s]={solved:0,correct:0}),stats.dailyStats[s].solved++,t&&stats.dailyStats[s].correct++,updateDailyStats(),saveStats()}function checkTrainingAnswer(t){const e=t===currentQuestion.correctAnswer;processAnswer(e),document.querySelectorAll(".option-btn").forEach((s=>{parseInt(s.textContent)===t?s.classList.add(e?"correct":"incorrect"):parseInt(s.textContent)===currentQuestion.correctAnswer&&s.classList.add("correct"),s.disabled=!0})),showAchievement(e?"–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ":`–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –û—Ç–≤–µ—Ç: ${currentQuestion.correctAnswer}`,!e),document.getElementById("trainingStreak").textContent=`üî• –°–µ—Ä–∏—è: ${sessionStreak}`,setTimeout((()=>{questionsAnswered>=totalQuestions||timeLeft<=0?endGame("training"):generateTrainingQuestion()}),1500)}function checkTestingAnswer(){const t=parseInt(document.getElementById("testingInput").value)===currentQuestion.correctAnswer;processAnswer(t);document.getElementById("testingFeedback").innerHTML=t?'<div class="achievement">‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!</div>':`<div class="achievement" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –û—Ç–≤–µ—Ç: ${currentQuestion.correctAnswer}</div>`,document.getElementById("testingStreak").textContent=`üî• –°–µ—Ä–∏—è: ${sessionStreak}`,setTimeout((()=>{questionsAnswered>=totalQuestions||timeLeft<=0?endGame("testing"):generateTestingQuestion()}),1e3)}function checkEnter(t,e){"Enter"===t.key&&"testing"===e&&checkTestingAnswer()}function updateProgress(t){const e=questionsAnswered/totalQuestions*100;document.getElementById(t+"Progress").style.width=e+"%",document.getElementById(t+"ProgressText").textContent=`${questionsAnswered}/${totalQuestions}`}function endGame(t){gameTimer&&(clearInterval(gameTimer),gameTimer=null);const e=sessionStats.totalTime/questionsAnswered,s=questionsAnswered>0?Math.round(sessionStats.correct/questionsAnswered*100):0;let n="üéØ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n\n";n+="üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–µ—Å—Å–∏–∏:\n",n+=`‚Ä¢ –í—Å–µ–≥–æ –ø—Ä–∏–º–µ—Ä–æ–≤: ${questionsAnswered}\n`,n+=`‚Ä¢ –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: ${sessionStats.correct}\n`,n+=`‚Ä¢ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: ${sessionStats.incorrect}\n`,n+=`‚Ä¢ –¢–æ—á–Ω–æ—Å—Ç—å: ${s}%\n`,n+=`‚Ä¢ –õ—É—á—à–∞—è —Å–µ—Ä–∏—è: ${sessionStreak}\n`,n+=`‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: ${e.toFixed(1)}—Å\n`,n+=`‚Ä¢ –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç: ${sessionStats.fastestAnswer.toFixed(1)}—Å\n`,n+=`‚Ä¢ –°–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π: ${sessionStats.slowestAnswer.toFixed(1)}—Å\n\n`,n+="üìà –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n",n+=`‚Ä¢ –í—Å–µ–≥–æ —Ä–µ—à–µ–Ω–æ: ${stats.totalSolved}\n`,n+=`‚Ä¢ –í—Å–µ–≥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: ${stats.correct}\n`,n+=`‚Ä¢ –í—Å–µ–≥–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: ${stats.totalSolved-stats.correct}\n`,n+=`‚Ä¢ –û–±—â–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å: ${Math.round(stats.correct/stats.totalSolved*100)}%\n`,n+=`‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: ${stats.averageTime.toFixed(1)}—Å\n`,n+=`‚Ä¢ –õ—É—á—à–∞—è —Å–µ—Ä–∏—è: ${stats.bestStreak}\n`,n+=`‚Ä¢ –î–Ω–µ–π –ø–æ–¥—Ä—è–¥: ${stats.weeklyStreak}\n`,checkAchievements(sessionStreak,s,e),alert(n),showMainMenu()}function showAchievement(t,e=!1){const s=document.createElement("div");s.className="feedback-message",e&&s.classList.add("error"),s.textContent=t,document.body.appendChild(s),setTimeout((()=>{s.remove()}),2e3)}function checkAchievements(t,e,s){const n=[];t>=5&&n.push("üî• –û—Ç–ª–∏—á–Ω–∞—è —Å–µ—Ä–∏—è!"),t>=10&&n.push("üåü –ú–∞—Å—Ç–µ—Ä —É–º–Ω–æ–∂–µ–Ω–∏—è!"),t>=15&&n.push("üíé –ù–µ–≤–µ—Ä–æ—è—Ç–Ω–∞—è —Å–µ—Ä–∏—è!"),e>=90&&n.push("üéØ –°–Ω–∞–π–ø–µ—Ä!"),100===e&&n.push("üèÜ –ò–¥–µ–∞–ª—å–Ω–æ!"),s<3&&n.push("‚ö° –ú–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–æ!"),s<2&&n.push("üöÄ –°–≤–µ—Ä—Ö—Å–∫–æ—Ä–æ—Å—Ç—å!"),stats.totalSolved>=100&&n.push("üíØ –°–æ—Ç–∫–∞!"),stats.totalSolved>=500&&n.push("üåü 500 –ø—Ä–∏–º–µ—Ä–æ–≤!"),stats.totalSolved>=1e3&&n.push("üëë 1000 –ø—Ä–∏–º–µ—Ä–æ–≤!"),stats.bestStreak>=20&&n.push("üèÜ –ß–µ–º–ø–∏–æ–Ω!"),stats.weeklyStreak>=7&&n.push("üìÖ –ù–µ–¥–µ–ª—è –ø–æ–¥—Ä—è–¥!"),stats.weeklyStreak>=30&&n.push("üóìÔ∏è –ú–µ—Å—è—Ü –ø–æ–¥—Ä—è–¥!"),n.forEach((t=>{setTimeout((()=>showAchievement(t)),1e3*Math.random())}))}function updateProgressDisplay(){document.getElementById("progressTotalSolved").textContent=stats.totalSolved,document.getElementById("progressCorrect").textContent=stats.correct,document.getElementById("progressAccuracy").textContent=stats.totalSolved>0?Math.round(stats.correct/stats.totalSolved*100)+"%":"0%",document.getElementById("progressBestStreak").textContent=stats.bestStreak;const t=document.getElementById("achievements"),e=[];stats.totalSolved>=10&&e.push("üéØ –ü–µ—Ä–≤—ã–µ 10 –ø—Ä–∏–º–µ—Ä–æ–≤"),stats.totalSolved>=50&&e.push("üìö 50 –ø—Ä–∏–º–µ—Ä–æ–≤ —Ä–µ—à–µ–Ω–æ"),stats.totalSolved>=100&&e.push("üíØ –°–æ—Ç–∫–∞ –ø—Ä–∏–º–µ—Ä–æ–≤!"),stats.totalSolved>=500&&e.push("üèÜ 500 –ø—Ä–∏–º–µ—Ä–æ–≤!"),stats.totalSolved>=1e3&&e.push("üëë 1000 –ø—Ä–∏–º–µ—Ä–æ–≤!"),stats.bestStreak>=5&&e.push("üî• –°–µ—Ä–∏—è –∏–∑ 5"),stats.bestStreak>=10&&e.push("üåü –°–µ—Ä–∏—è –∏–∑ 10"),stats.bestStreak>=20&&e.push("üëë –°–µ—Ä–∏—è –∏–∑ 20"),stats.bestStreak>=50&&e.push("üíé –°–µ—Ä–∏—è –∏–∑ 50"),stats.correct/stats.totalSolved>=.9&&stats.totalSolved>=20&&e.push("üéØ 90% —Ç–æ—á–Ω–æ—Å—Ç–∏"),stats.correct/stats.totalSolved>=.95&&stats.totalSolved>=50&&e.push("üíé 95% —Ç–æ—á–Ω–æ—Å—Ç–∏"),stats.averageTime<3&&stats.totalSolved>=20&&e.push("‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—á–µ—Ç"),stats.averageTime<2&&stats.totalSolved>=50&&e.push("üöÄ –°–≤–µ—Ä—Ö—Å–∫–æ—Ä–æ—Å—Ç—å"),stats.weeklyStreak>=3&&e.push("üìÖ 3 –¥–Ω—è –ø–æ–¥—Ä—è–¥"),stats.weeklyStreak>=7&&e.push("üìÖ –ù–µ–¥–µ–ª—è –ø–æ–¥—Ä—è–¥"),stats.bestWeeklyStreak>=30&&e.push("üóìÔ∏è –ú–µ—Å—è—Ü –ø–æ–¥—Ä—è–¥"),t.innerHTML=e.length>0?e.map((t=>`<div class="achievement">${t}</div>`)).join(""):"<p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π. –ù–∞—á–Ω–∏—Ç–µ —Ä–µ—à–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã!</p>";const s=document.getElementById("tableProgress");let n='<div class="stats">';for(let t=2;t<=9;t++){const e=stats.tableProgress[t]||0;n+=`\n                    <div class="stat-item">\n                        <div class="stat-number">${e}</div>\n                        <div class="stat-label">–¢–∞–±–ª–∏—Ü–∞ ${t}<br><small>${e<10?"–ù–∞—á–∏–Ω–∞—é—â–∏–π":e<25?"–£—á–µ–Ω–∏–∫":e<50?"–ó–Ω–∞—Ç–æ–∫":e<100?"–ú–∞—Å—Ç–µ—Ä":"–≠–∫—Å–ø–µ—Ä—Ç"}</small></div>\n                    </div>\n                `}n+="</div>",s.innerHTML=n,document.getElementById("detailedStats")&&(document.getElementById("detailedStats").innerHTML=`\n                    <div class="stats">\n                        <div class="stat-item">\n                            <div class="stat-number">${stats.averageTime.toFixed(1)}—Å</div>\n                            <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</div>\n                        </div>\n                        <div class="stat-item">\n                            <div class="stat-number">${stats.fastestAnswer.toFixed(1)}—Å</div>\n                            <div class="stat-label">–ë—ã—Å—Ç—Ä–µ–π—à–∏–π –æ—Ç–≤–µ—Ç</div>\n                        </div>\n                        <div class="stat-item">\n                            <div class="stat-number">${stats.weeklyStreak}</div>\n                            <div class="stat-label">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>\n                        </div>\n                        <div class="stat-item">\n                            <div class="stat-number">${stats.bestWeeklyStreak}</div>\n                            <div class="stat-label">–õ—É—á—à–∞—è —Å–µ—Ä–∏—è –¥–Ω–µ–π</div>\n                        </div>\n                    </div>\n                `)}function resetProgress(){confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.")&&(stats={totalSolved:0,correct:0,currentStreak:0,bestStreak:0,tableProgress:{2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},averageTime:0,totalTime:0,fastestAnswer:999,slowestAnswer:0,dailyStats:{},weeklyStreak:0,bestWeeklyStreak:0},saveStats(),updateMainMenuStats(),updateProgressDisplay(),showAchievement("–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω!"))}function getAdaptiveQuestion(){const t=[];let e=Math.min(...Object.values(stats.tableProgress));for(let s in stats.tableProgress)stats.tableProgress[s]===e&&t.push(parseInt(s));return t[Math.floor(Math.random()*t.length)]}function startAdaptiveTraining(){const t=getAdaptiveQuestion();startTraining(t),showAchievement(`–¢—Ä–µ–Ω–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—É ${t} - –≤–∞—à–µ —Å–ª–∞–±–æ–µ –º–µ—Å—Ç–æ!`)}function exportProgress(){const t={stats:stats,exportDate:(new Date).toISOString(),version:"2.0"},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),s=URL.createObjectURL(e),n=document.createElement("a");n.href=s,n.download="multiplication-progress.json",n.click(),URL.revokeObjectURL(s)}function playSound(t){try{const e=new(window.AudioContext||window.webkitAudioContext),s=e.createOscillator(),n=e.createGain();s.connect(n),n.connect(e.destination),"correct"===t?(s.frequency.setValueAtTime(523.25,e.currentTime),s.frequency.setValueAtTime(659.25,e.currentTime+.1)):s.frequency.setValueAtTime(220,e.currentTime),n.gain.setValueAtTime(.1,e.currentTime),n.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),s.start(e.currentTime),s.stop(e.currentTime+.3)}catch(t){}}loadStats(),updateMainMenuStats(),document.addEventListener("DOMContentLoaded",(function(){updateMainMenuStats(),document.addEventListener("keydown",(function(t){"Escape"===t.key&&showMainMenu()}))}));
